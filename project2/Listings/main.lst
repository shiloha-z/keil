C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\KEIL\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.ls
                    -t) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include<reg52.h>
   2          #include <string.h>
   3          #include <intrins.h>
   4          #define uint unsigned int
   5          #define uchar unsigned char
   6          
   7          
   8          
   9          #define yh 0x80 //LCDç¬¬ä¸€è¡Œçš„åˆå§‹ä½ç½®,å› ä¸ºLCD1602å­—ç¬¦åœ°å€é¦–ä½D7æ’å®šä¸º1ï¼ˆ100000000=80ï¼
             -‰
  10          #define er 0x80+0x44 //LCDç¬¬äºŒè¡Œåˆå§‹ä½ç½®ï¼ˆå› ä¸ºç¬¬äºŒè¡Œç¬¬ä¸€ä¸ªå­—ç¬¦ä½ç½®åœ°å€æ˜¯0x40ï¼‰
  11          #define ner 0x80+0x40
  12          
  13          //æ¶²æ™¶å±çš„ä¸C51ä¹‹é—´çš„å¼•è„šè¿æ¥å®šä¹‰ï¼ˆæ˜¾ç¤ºæ•°æ®çº¿æ¥C51çš„P0å£ï¼‰
  14          sbit en=P2^7;
  15          sbit rw=P2^6;   //å¦‚æœç¡¬ä»¶ä¸Šrwæ¥åœ°ï¼Œå°±ä¸ç”¨å†™è¿™å¥å’Œåé¢çš„rw=0äº†
  16          sbit rs=P2^5;
  17          sbit P37=P3^7;
  18          code uchar TH0T=(65535-1000)/256; 
  19          code uchar TL0T=(65535-1000)%256; 
  20          
  21          //æ ¡æ—¶æŒ‰é”®ä¸C51çš„å¼•è„šè¿æ¥å®šä¹‰
  22          
  23          sbit set=P3^0;    //è®¾ç½®é”®
  24          sbit add=P3^1;    //åŠ é”®
  25          sbit dec=P3^2;    //å‡é”®
  26          sbit seeNL_NZ=P3^3; //æŸ¥çœ‹/é—¹é’Ÿ
  27            
  28          
  29          sbit DQ=P2^4;   //
  30          sbit buzzer=P2^3; //èœ‚é¸£å™¨ï¼Œé€šè¿‡ä¸‰æç®¡8550é©±åŠ¨ï¼Œç«¯å£ä½ç”µå¹³å“
  31          
  32          
  33          sbit led=P3^7;    
  34          bit  led1=1;
  35          
  36          unsigned char temp_miao;
  37          
  38          uchar tflag;//æ¸©åº¦æ­£è´Ÿæ ‡å¿—
  39          
  40          //DS1302æ—¶é’ŸèŠ¯ç‰‡ä¸C51ä¹‹é—´çš„å¼•è„šè¿æ¥å®šä¹‰
  41          sbit IO=P2^1;
  42          sbit SCLK=P2^0;
  43          sbit RST=P2^2;
  44          
  45          unsigned int STPtime=0;
  46          uchar oSTPtime=100,STPSec=0,STPMin=0;
  47          
  48          uchar a,miao,shi,fen,ri,yue,nian,week,setn,temp;
  49          uint flag;
  50          //flagç”¨äºè¯»å–å¤´æ–‡ä»¶ä¸­çš„æ¸©åº¦å€¼ï¼Œå’Œæ˜¾ç¤ºæ¸©åº¦å€¼
  51          bit c_moon;
  52          
  53          uchar nz_shi=12,nz_fen=0,nz_miao=0,setNZn;      //å®šä¹‰é—¹é’Ÿå˜é‡
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 2   

  54          uchar shangyimiao,bsn,temp_hour;      //è®°å½•ä¸Šä¸€ç§’æ—¶é—´
  55          uchar T_NL_NZ;              //è®¡æ•°å™¨
  56          bit timerOn=0;              //é—¹é’Ÿå¯ç”¨æ ‡å¿—ä½
  57          bit baoshi=0;             //æ•´ç‚¹æŠ¥æ—¶æ ‡å¿—ä½
  58          bit  p_r=0;               //å¹³å¹´/æ¶¦å¹´  =0è¡¨ç¤ºå¹³å¹´ï¼Œ=1è¡¨ç¤ºæ¶¦å¹´
  59          data uchar year_moon,month_moon,day_moon,week;
  60          
  61          bit fSTPW=0,fAlarm=0,STPRun=0,STPPause=0;
  62          
  63          sbit ACC0=ACC^0;
  64          sbit ACC7=ACC^7;
  65          /************************************************************
  66          ACCç´¯åŠ å™¨=A
  67          ACC.0=E0H 
  68          
  69          ACC.0å°±æ˜¯ACCçš„ç¬¬0ä½ã€‚Accå¯ä»¥ä½å¯»å€ã€‚
  70          
  71          ç´¯åŠ å™¨ACCæ˜¯ä¸€ä¸ª8ä½çš„å­˜å‚¨å•å…ƒï¼Œæ˜¯ç”¨æ¥æ”¾æ•°æ®çš„ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªå­˜å‚¨å•å…ƒæœ‰å…¶ç‰¹æ®Š
             -çš„åœ°ä½ï¼Œ
  72          æ˜¯å•ç‰‡æœºä¸­ä¸€ä¸ªéå¸¸å…³é”®çš„å•å…ƒï¼Œå¾ˆå¤šè¿ç®—éƒ½è¦é€šè¿‡ACCæ¥è¿›è¡Œã€‚ä»¥ååœ¨å­¦ä¹ æŒ‡ä»¤æ
             -—¶ï¼Œ
  73          å¸¸ç”¨Aæ¥è¡¨ç¤ºç´¯åŠ å™¨ã€‚ä½†æœ‰ä¸€äº›åœ°æ–¹ä¾‹å¤–ï¼Œæ¯”å¦‚åœ¨PUSHæŒ‡ä»¤ä¸­ï¼Œå°±å¿…é¡»ç”¨ACCè¿™æ ·çš„å
             -å­—ã€‚
  74          ä¸€èˆ¬çš„è¯´æ³•ï¼ŒAä»£è¡¨äº†ç´¯åŠ å™¨ä¸­çš„å†…å®¹ã€è€ŒACCä»£è¡¨çš„æ˜¯ç´¯åŠ å™¨çš„åœ°å€ã€‚ 
  75          ***************************************************************/
  76          
  77          
  78          
  79          //********é˜³å†è½¬æ¢é˜´å†è¡¨************************************
  80          code uchar year_code[597]={
  81                              0x04,0xAe,0x53,    //1901 0
  82                              0x0A,0x57,0x48,    //1902 3
  83                              0x55,0x26,0xBd,    //1903 6
  84                              0x0d,0x26,0x50,    //1904 9
  85                              0x0d,0x95,0x44,    //1905 12
  86                              0x46,0xAA,0xB9,    //1906 15
  87                              0x05,0x6A,0x4d,    //1907 18
  88                              0x09,0xAd,0x42,    //1908 21
  89                              0x24,0xAe,0xB6,    //1909
  90                              0x04,0xAe,0x4A,    //1910
  91                              0x6A,0x4d,0xBe,    //1911
  92                              0x0A,0x4d,0x52,    //1912
  93                              0x0d,0x25,0x46,    //1913
  94                              0x5d,0x52,0xBA,    //1914
  95                              0x0B,0x54,0x4e,    //1915
  96                              0x0d,0x6A,0x43,    //1916
  97                              0x29,0x6d,0x37,    //1917
  98                              0x09,0x5B,0x4B,    //1918
  99                              0x74,0x9B,0xC1,    //1919
 100                              0x04,0x97,0x54,    //1920
 101                              0x0A,0x4B,0x48,    //1921
 102                              0x5B,0x25,0xBC,    //1922
 103                              0x06,0xA5,0x50,    //1923
 104                              0x06,0xd4,0x45,    //1924
 105                              0x4A,0xdA,0xB8,    //1925
 106                              0x02,0xB6,0x4d,    //1926
 107                              0x09,0x57,0x42,    //1927
 108                              0x24,0x97,0xB7,    //1928
 109                              0x04,0x97,0x4A,    //1929
 110                              0x66,0x4B,0x3e,    //1930
 111                              0x0d,0x4A,0x51,    //1931
 112                              0x0e,0xA5,0x46,    //1932
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 3   

 113                              0x56,0xd4,0xBA,    //1933
 114                              0x05,0xAd,0x4e,    //1934
 115                              0x02,0xB6,0x44,    //1935
 116                              0x39,0x37,0x38,    //1936
 117                              0x09,0x2e,0x4B,    //1937
 118                              0x7C,0x96,0xBf,    //1938
 119                              0x0C,0x95,0x53,    //1939
 120                              0x0d,0x4A,0x48,    //1940
 121                              0x6d,0xA5,0x3B,    //1941
 122                              0x0B,0x55,0x4f,    //1942
 123                              0x05,0x6A,0x45,    //1943
 124                              0x4A,0xAd,0xB9,    //1944
 125                              0x02,0x5d,0x4d,    //1945
 126                              0x09,0x2d,0x42,    //1946
 127                              0x2C,0x95,0xB6,    //1947
 128                              0x0A,0x95,0x4A,    //1948
 129                              0x7B,0x4A,0xBd,    //1949
 130                              0x06,0xCA,0x51,    //1950
 131                              0x0B,0x55,0x46,    //1951
 132                              0x55,0x5A,0xBB,    //1952
 133                              0x04,0xdA,0x4e,    //1953
 134                              0x0A,0x5B,0x43,    //1954
 135                              0x35,0x2B,0xB8,    //1955
 136                              0x05,0x2B,0x4C,    //1956
 137                              0x8A,0x95,0x3f,    //1957
 138                              0x0e,0x95,0x52,    //1958
 139                              0x06,0xAA,0x48,    //1959
 140                              0x7A,0xd5,0x3C,    //1960
 141                              0x0A,0xB5,0x4f,    //1961
 142                              0x04,0xB6,0x45,    //1962
 143                              0x4A,0x57,0x39,    //1963
 144                              0x0A,0x57,0x4d,    //1964
 145                              0x05,0x26,0x42,    //1965
 146                              0x3e,0x93,0x35,    //1966
 147                              0x0d,0x95,0x49,    //1967
 148                              0x75,0xAA,0xBe,    //1968
 149                              0x05,0x6A,0x51,    //1969
 150                              0x09,0x6d,0x46,    //1970
 151                              0x54,0xAe,0xBB,    //1971
 152                              0x04,0xAd,0x4f,    //1972
 153                              0x0A,0x4d,0x43,    //1973
 154                              0x4d,0x26,0xB7,    //1974
 155                              0x0d,0x25,0x4B,    //1975
 156                              0x8d,0x52,0xBf,    //1976
 157                              0x0B,0x54,0x52,    //1977
 158                              0x0B,0x6A,0x47,    //1978
 159                              0x69,0x6d,0x3C,    //1979
 160                              0x09,0x5B,0x50,    //1980
 161                              0x04,0x9B,0x45,    //1981
 162                              0x4A,0x4B,0xB9,    //1982
 163                              0x0A,0x4B,0x4d,    //1983
 164                              0xAB,0x25,0xC2,    //1984
 165                              0x06,0xA5,0x54,    //1985
 166                              0x06,0xd4,0x49,    //1986
 167                              0x6A,0xdA,0x3d,    //1987
 168                              0x0A,0xB6,0x51,    //1988
 169                              0x09,0x37,0x46,    //1989
 170                              0x54,0x97,0xBB,    //1990
 171                              0x04,0x97,0x4f,    //1991
 172                              0x06,0x4B,0x44,    //1992
 173                              0x36,0xA5,0x37,    //1993
 174                              0x0e,0xA5,0x4A,    //1994
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 4   

 175                              0x86,0xB2,0xBf,    //1995
 176                              0x05,0xAC,0x53,    //1996
 177                              0x0A,0xB6,0x47,    //1997
 178                              0x59,0x36,0xBC,    //1998
 179                              0x09,0x2e,0x50,    //1999 294
 180                              0x0C,0x96,0x45,    //2000 297
 181                              0x4d,0x4A,0xB8,    //2001
 182                              0x0d,0x4A,0x4C,    //2002
 183                              0x0d,0xA5,0x41,    //2003
 184                              0x25,0xAA,0xB6,    //2004
 185                              0x05,0x6A,0x49,    //2005
 186                              0x7A,0xAd,0xBd,    //2006
 187                              0x02,0x5d,0x52,    //2007
 188                              0x09,0x2d,0x47,    //2008
 189                              0x5C,0x95,0xBA,    //2009
 190                              0x0A,0x95,0x4e,    //2010
 191                              0x0B,0x4A,0x43,    //2011
 192                              0x4B,0x55,0x37,    //2012
 193                              0x0A,0xd5,0x4A,    //2013
 194                              0x95,0x5A,0xBf,    //2014
 195                              0x04,0xBA,0x53,    //2015
 196                              0x0A,0x5B,0x48,    //2016
 197                              0x65,0x2B,0xBC,    //2017
 198                              0x05,0x2B,0x50,    //2018
 199                              0x0A,0x93,0x45,    //2019
 200                              0x47,0x4A,0xB9,    //2020
 201                              0x06,0xAA,0x4C,    //2021
 202                              0x0A,0xd5,0x41,    //2022
 203                              0x24,0xdA,0xB6,    //2023
 204                              0x04,0xB6,0x4A,    //2024
 205                              0x69,0x57,0x3d,    //2025
 206                              0x0A,0x4e,0x51,    //2026
 207                              0x0d,0x26,0x46,    //2027
 208                              0x5e,0x93,0x3A,    //2028
 209                              0x0d,0x53,0x4d,    //2029
 210                              0x05,0xAA,0x43,    //2030
 211                              0x36,0xB5,0x37,    //2031
 212                              0x09,0x6d,0x4B,    //2032
 213                              0xB4,0xAe,0xBf,    //2033
 214                              0x04,0xAd,0x53,    //2034
 215                              0x0A,0x4d,0x48,    //2035
 216                              0x6d,0x25,0xBC,    //2036
 217                              0x0d,0x25,0x4f,    //2037
 218                              0x0d,0x52,0x44,    //2038
 219                              0x5d,0xAA,0x38,    //2039
 220                              0x0B,0x5A,0x4C,    //2040
 221                              0x05,0x6d,0x41,    //2041
 222                              0x24,0xAd,0xB6,    //2042
 223                              0x04,0x9B,0x4A,    //2043
 224                              0x7A,0x4B,0xBe,    //2044
 225                              0x0A,0x4B,0x51,    //2045
 226                              0x0A,0xA5,0x46,    //2046
 227                              0x5B,0x52,0xBA,    //2047
 228                              0x06,0xd2,0x4e,    //2048
 229                              0x0A,0xdA,0x42,    //2049
 230                              0x35,0x5B,0x37,    //2050
 231                              0x09,0x37,0x4B,    //2051
 232                              0x84,0x97,0xC1,    //2052
 233                              0x04,0x97,0x53,    //2053
 234                              0x06,0x4B,0x48,    //2054
 235                              0x66,0xA5,0x3C,    //2055
 236                              0x0e,0xA5,0x4f,    //2056
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 5   

 237                              0x06,0xB2,0x44,    //2057
 238                              0x4A,0xB6,0x38,    //2058
 239                              0x0A,0xAe,0x4C,    //2059
 240                              0x09,0x2e,0x42,    //2060
 241                              0x3C,0x97,0x35,    //2061
 242                              0x0C,0x96,0x49,    //2062
 243                              0x7d,0x4A,0xBd,    //2063
 244                              0x0d,0x4A,0x51,    //2064
 245                              0x0d,0xA5,0x45,    //2065
 246                              0x55,0xAA,0xBA,    //2066
 247                              0x05,0x6A,0x4e,    //2067
 248                              0x0A,0x6d,0x43,    //2068
 249                              0x45,0x2e,0xB7,    //2069
 250                              0x05,0x2d,0x4B,    //2070
 251                              0x8A,0x95,0xBf,    //2071
 252                              0x0A,0x95,0x53,    //2072
 253                              0x0B,0x4A,0x47,    //2073
 254                              0x6B,0x55,0x3B,    //2074
 255                              0x0A,0xd5,0x4f,    //2075
 256                              0x05,0x5A,0x45,    //2076
 257                              0x4A,0x5d,0x38,    //2077
 258                              0x0A,0x5B,0x4C,    //2078
 259                              0x05,0x2B,0x42,    //2079
 260                              0x3A,0x93,0xB6,    //2080
 261                              0x06,0x93,0x49,    //2081
 262                              0x77,0x29,0xBd,    //2082
 263                              0x06,0xAA,0x51,    //2083
 264                              0x0A,0xd5,0x46,    //2084
 265                              0x54,0xdA,0xBA,    //2085
 266                              0x04,0xB6,0x4e,    //2086
 267                              0x0A,0x57,0x43,    //2087
 268                              0x45,0x27,0x38,    //2088
 269                              0x0d,0x26,0x4A,    //2089
 270                              0x8e,0x93,0x3e,    //2090
 271                              0x0d,0x52,0x52,    //2091
 272                              0x0d,0xAA,0x47,    //2092
 273                              0x66,0xB5,0x3B,    //2093
 274                              0x05,0x6d,0x4f,    //2094
 275                              0x04,0xAe,0x45,    //2095
 276                              0x4A,0x4e,0xB9,    //2096
 277                              0x0A,0x4d,0x4C,    //2097
 278                              0x0d,0x15,0x41,    //2098
 279                              0x2d,0x92,0xB5,    //2099
 280          };
 281          
 282          ///æœˆä»½æ•°æ®è¡¨
 283          code uchar day_code1[9]={0x0,0x1f,0x3b,0x5a,0x78,0x97,0xb5,0xd4,0xf3};
 284          code uint day_code2[3]={0x111,0x130,0x14e};
 285          
 286          
 287          
 288          /*
 289          å‡½æ•°åŠŸèƒ½:è¾“å…¥BCDé˜³å†æ•°æ®,è¾“å‡ºBCDæ˜ŸæœŸæ•°æ®(åªå…è®¸1901-2099å¹´)
 290          è°ƒç”¨å‡½æ•°ç¤ºä¾‹:Conver_week(c_sun,year_sun,month_sun,day_sun)
 291          å¦‚:è®¡ç®—2004å¹´10æœˆ16æ—¥Conversion(0,0x4,0x10,0x16);
 292          c_sun,year_sun,month_sun,day_sunå‡ä¸ºBCDæ•°æ®,c_sunä¸ºä¸–çºªæ ‡å¿—ä½,c_sun=0ä¸º21ä¸–
 293          çºª,c_sun=1ä¸º19ä¸–çºª
 294          è°ƒç”¨å‡½æ•°å,åŸæœ‰æ•°æ®ä¸å˜,è¯»weekå¾—å‡ºé˜´å†BCDæ•°æ®
 295          */
 296          code uchar table_week[12]={0,3,3,6,1,4,6,2,5,0,3,5}; //æœˆä¿®æ­£æ•°æ®è¡¨
 297          /*
 298          ç®—æ³•:æ—¥æœŸ+å¹´ä»½+æ‰€è¿‡é—°å¹´æ•°+æœˆè¾ƒæ­£æ•°ä¹‹å’Œé™¤7 çš„ä½™æ•°å°±æ˜¯æ˜ŸæœŸä½†å¦‚æœæ˜¯åœ¨
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 6   

 299          é—°å¹´åˆä¸åˆ°3 æœˆä»½ä¸Šè¿°ä¹‹å’Œè¦å‡ä¸€å¤©å†é™¤7
 300          æ˜ŸæœŸæ•°ä¸º0
 301          */
 302          void Conver_week(uchar year,uchar month,uchar day)
 303          {//c=0 ä¸º21ä¸–çºª,c=1 ä¸º19ä¸–çºª è¾“å…¥è¾“å‡ºæ•°æ®å‡ä¸ºBCDæ•°æ®
 304   1          uchar p1,p2;
 305   1          year+=0x64;  //å¦‚æœä¸º21ä¸–çºª,å¹´ä»½æ•°åŠ 100
 306   1          p1=year/0x4;  //æ‰€è¿‡é—°å¹´æ•°åªç®—1900å¹´ä¹‹åçš„
 307   1          p2=year+p1;
 308   1          p2=p2%0x7;  //ä¸ºèŠ‚çœèµ„æº,å…ˆè¿›è¡Œä¸€æ¬¡å–ä½™,é¿å…æ•°å¤§äº0xff,é¿å…ä½¿ç”¨æ•´å‹æ•°æ®
 309   1          p2=p2+day+table_week[month-1];
 310   1          if (year%0x4==0&&month<3)p2-=1;
 311   1          week=p2%0x7;
 312   1      }
 313          
 314          
 315          /**************************************************************/
 316          
 317          uchar code tab1[]={"20  -  -   "};  //å¹´æ˜¾ç¤ºçš„å›ºå®šå­—ç¬¦
 318          uchar code tab2[]={"  :  :  "};   //æ—¶é—´æ˜¾ç¤ºçš„å›ºå®šå­—ç¬¦
 319          
 320          uchar code NZd[]={"timer:    -  -  "};  //æ˜¾ç¤ºé—¹é’Ÿå›ºå®šç‚¹
 321          uchar code qk[]= {"                "};  //æ¸…ç©ºæ˜¾ç¤º
 322          uchar code tm[]= {"time"};
 323          
 324          
 325          
 326          
 327          
 328          //*****************************************************************************
 329          
 330          //å»¶æ—¶å‡½æ•°ï¼Œåé¢ç»å¸¸è°ƒç”¨
 331          void delay(uint xms)//å»¶æ—¶å‡½æ•°ï¼Œæœ‰å‚å‡½æ•°
 332          {
 333   1        uint x,y;
 334   1        for(x=xms;x>0;x--)
 335   1         for(y=110;y>0;y--);
 336   1      }
 337          
 338          /********æ¶²æ™¶å†™å…¥æŒ‡ä»¤å‡½æ•°ä¸å†™å…¥æ•°æ®å‡½æ•°ï¼Œä»¥åå¯è°ƒç”¨**************/
 339          
 340          /*åœ¨è¿™ä¸ªç¨‹åºä¸­ï¼Œæ¶²æ™¶å†™å…¥æœ‰å…³å‡½æ•°ä¼šåœ¨DS1302çš„å‡½æ•°ä¸­è°ƒç”¨ï¼Œæ‰€ä»¥æ¶²æ™¶ç¨‹åºè¦æ”¾åœ
             -¨å‰é¢*/
 341          
 342          void write_1602com(uchar com)//****æ¶²æ™¶å†™å…¥æŒ‡ä»¤å‡½æ•°****
 343          {
 344   1        rs=0;//æ•°æ®/æŒ‡ä»¤é€‰æ‹©ç½®ä¸ºæŒ‡ä»¤
 345   1        rw=0; //è¯»å†™é€‰æ‹©ç½®ä¸ºå†™
 346   1        P0=com;//é€å…¥æ•°æ®
 347   1        delay(1);
 348   1        en=1;//æ‹‰é«˜ä½¿èƒ½ç«¯ï¼Œä¸ºåˆ¶é€ æœ‰æ•ˆçš„ä¸‹é™æ²¿åšå‡†å¤‡
 349   1        delay(1);
 350   1        en=0;//enç”±é«˜å˜ä½ï¼Œäº§ç”Ÿä¸‹é™æ²¿ï¼Œæ¶²æ™¶æ‰§è¡Œå‘½ä»¤
 351   1      }
 352          
 353          
 354          void write_1602dat(uchar dat)//***æ¶²æ™¶å†™å…¥æ•°æ®å‡½æ•°****
 355          {
 356   1        rs=1;//æ•°æ®/æŒ‡ä»¤é€‰æ‹©ç½®ä¸ºæ•°æ®
 357   1        rw=0; //è¯»å†™é€‰æ‹©ç½®ä¸ºå†™
 358   1        P0=dat;//é€å…¥æ•°æ®
 359   1        delay(1);
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 7   

 360   1        en=1; //enç½®é«˜ç”µå¹³ï¼Œä¸ºåˆ¶é€ ä¸‹é™æ²¿åšå‡†å¤‡
 361   1        delay(1);
 362   1        en=0; //enç”±é«˜å˜ä½ï¼Œäº§ç”Ÿä¸‹é™æ²¿ï¼Œæ¶²æ™¶æ‰§è¡Œå‘½ä»¤
 363   1      }
 364          
 365          
 366          void lcd_init(void)//***æ¶²æ™¶åˆå§‹åŒ–å‡½æ•°****
 367          {
 368   1        write_1602com(0x38);//è®¾ç½®æ¶²æ™¶å·¥ä½œæ¨¡å¼ï¼Œæ„æ€ï¼š16*2è¡Œæ˜¾ç¤ºï¼Œ5*7ç‚¹é˜µï¼Œ8ä½æ•°æ®
 369   1        write_1602com(0x0c);//å¼€æ˜¾ç¤ºä¸æ˜¾ç¤ºå…‰æ ‡
 370   1        write_1602com(0x06);//æ•´å±ä¸ç§»åŠ¨ï¼Œå…‰æ ‡è‡ªåŠ¨å³ç§»
 371   1        write_1602com(0x01);//æ¸…æ˜¾ç¤º
 372   1      
 373   1        write_1602com(yh+1);//æ—¥å†æ˜¾ç¤ºå›ºå®šç¬¦å·ä»ç¬¬ä¸€è¡Œç¬¬1ä¸ªä½ç½®ä¹‹åå¼€å§‹æ˜¾ç¤º
 374   1        for(a=0;a<14;a++)
 375   1        {
 376   2        write_1602dat(tab1[a]);//å‘æ¶²æ™¶å±å†™æ—¥å†æ˜¾ç¤ºçš„å›ºå®šç¬¦å·éƒ¨åˆ†
 377   2        //delay(3);
 378   2        }
 379   1        write_1602com(er);//æ—¶é—´æ˜¾ç¤ºå›ºå®šç¬¦å·å†™å…¥ä½ç½®ï¼Œä»ç¬¬2ä¸ªä½ç½®åå¼€å§‹æ˜¾ç¤º
 380   1        for(a=0;a<8;a++)
 381   1        {
 382   2        write_1602dat(tab2[a]);//å†™æ˜¾ç¤ºæ—¶é—´å›ºå®šç¬¦å·ï¼Œä¸¤ä¸ªå†’å·
 383   2        //delay(3);
 384   2        }
 385   1      
 386   1      }
 387          
 388          /*********************over***********************/
 389          
 390          
 391          /***************DS1302æœ‰å…³å­å‡½æ•°********************/
 392          void write_byte(uchar dat)//å†™ä¸€ä¸ªå­—èŠ‚
 393          {
 394   1        ACC=dat;
 395   1        RST=1;
 396   1        for(a=8;a>0;a--)
 397   1        {
 398   2          IO=ACC0;
 399   2          SCLK=0;
 400   2          SCLK=1;
 401   2          ACC=ACC>>1;
 402   2        }
 403   1      }
 404          uchar read_byte()//è¯»ä¸€ä¸ªå­—èŠ‚
 405          {
 406   1        RST=1;
 407   1        for(a=8;a>0;a--)
 408   1        {
 409   2          ACC7=IO;
 410   2          SCLK=1;
 411   2          SCLK=0;
 412   2          ACC=ACC>>1;
 413   2      
 414   2        }
 415   1        return (ACC);
 416   1      }
 417          //----------------------------------------
 418          void write_1302(uchar add,uchar dat)//å‘1302èŠ¯ç‰‡å†™å‡½æ•°ï¼ŒæŒ‡å®šå†™å…¥åœ°å€ï¼Œæ•°æ®
 419          {
 420   1        RST=0;
 421   1        SCLK=0;
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 8   

 422   1        RST=1;
 423   1        write_byte(add);
 424   1        write_byte(dat);
 425   1        SCLK=1;
 426   1        RST=0;
 427   1      }
 428          uchar read_1302(uchar add)//ä»1302è¯»æ•°æ®å‡½æ•°ï¼ŒæŒ‡å®šè¯»å–æ•°æ®æ¥æºåœ°å€
 429          {
 430   1        uchar temp;
 431   1        RST=0;
 432   1        SCLK=0;
 433   1        RST=1;
 434   1        write_byte(add);
 435   1        temp=read_byte();
 436   1        SCLK=1;
 437   1        RST=0;
 438   1        return(temp);
 439   1      }
 440          
 441          uchar BCD_Decimal(uchar bcd)//BCDç è½¬åè¿›åˆ¶å‡½æ•°ï¼Œè¾“å…¥BCDï¼Œè¿”å›åè¿›åˆ¶
 442          {
 443   1         uchar Decimal;
 444   1         Decimal=bcd>>4;
 445   1         return(Decimal=Decimal*10+(bcd&=0x0F));
 446   1      }
 447          
 448          //--------------------------------------
 449          void ds1302_init() //1302èŠ¯ç‰‡åˆå§‹åŒ–å­å‡½æ•°(2010-01-07,12:00:00,week4)
 450          {
 451   1        RST=0;
 452   1        SCLK=0;
 453   1        
 454   1        write_1302(0x8e,0x00); //å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤ 
 455   1        write_1302(0xa0,0x00); //å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤ 
 456   1        write_1302(0xa0,0x00); //å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤ 
 457   1        write_1302(0xa0,0x00); //å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤ 
 458   1        
 459   1        //write_1302(0x80,0x00); //å‘DS1302å†…å†™ç§’å¯„å­˜å™¨80Hå†™å…¥åˆå§‹ç§’æ•°æ®00
 460   1        //write_1302(0x82,0x00);//å‘DS1302å†…å†™åˆ†å¯„å­˜å™¨82Hå†™å…¥åˆå§‹åˆ†æ•°æ®00
 461   1        //write_1302(0x84,0x12);//å‘DS1302å†…å†™å°æ—¶å¯„å­˜å™¨84Hå†™å…¥åˆå§‹å°æ—¶æ•°æ®12
 462   1        //write_1302(0x8a,0x04);//å‘DS1302å†…å†™å‘¨å¯„å­˜å™¨8aHå†™å…¥åˆå§‹å‘¨æ•°æ®4
 463   1        //write_1302(0x86,0x07);//å‘DS1302å†…å†™æ—¥æœŸå¯„å­˜å™¨86Hå†™å…¥åˆå§‹æ—¥æœŸæ•°æ®07
 464   1        //write_1302(0x88,0x01);//å‘DS1302å†…å†™æœˆä»½å¯„å­˜å™¨88Hå†™å…¥åˆå§‹æœˆä»½æ•°æ®01
 465   1        //write_1302(0x8c,0x10);//å‘DS1302å†…å†™å¹´ä»½å¯„å­˜å™¨8cHå†™å…¥åˆå§‹å¹´ä»½æ•°æ®10
 466   1        write_1302(0x8e,0x80); //æ‰“å¼€å†™ä¿æŠ¤
 467   1      }
 468          
 469          
 470          
 471          
 472          //------------------------------------
 473          //æ—¶åˆ†ç§’æ˜¾ç¤ºå­å‡½æ•°
 474          void write_sfm(uchar add,uchar dat)//å‘LCDå†™æ—¶åˆ†ç§’,æœ‰æ˜¾ç¤ºä½ç½®åŠ ã€ç°ç¤ºæ•°æ®ï¼Œä¸¤ä¸ªå‚æ•°
 475          {
 476   1        uchar gw,sw;
 477   1        gw=dat%10;//å–å¾—ä¸ªä½æ•°å­—
 478   1        sw=dat/10;//å–å¾—åä½æ•°å­—
 479   1         write_1602com(ner+2);//eræ˜¯å¤´æ–‡ä»¶è§„å®šçš„å€¼0x80+0x40
 480   1        write_1602dat(' ');// ç©ºæ ¼
 481   1        write_1602com(er+add);//eræ˜¯å¤´æ–‡ä»¶è§„å®šçš„å€¼0x80+0x40
 482   1        write_1602dat(0x30+sw);//æ•°å­—+30å¾—åˆ°è¯¥æ•°å­—çš„LCD1602æ˜¾ç¤ºç 
 483   1        write_1602dat(0x30+gw);//æ•°å­—+30å¾—åˆ°è¯¥æ•°å­—çš„LCD1602æ˜¾ç¤ºç         
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 9   

 484   1      }
 485          
 486          //------------------------------------
 487          //æ—¶åˆ†ç§’æ˜¾ç¤ºå­å‡½æ•°
 488          void write_nsfm(uchar add,uchar dat)//å‘LCDå†™æ—¶åˆ†ç§’,æœ‰æ˜¾ç¤ºä½ç½®åŠ ã€ç°ç¤ºæ•°æ®ï¼Œä¸¤ä¸ªå‚æ•°
 489          {
 490   1        uchar gw,sw;
 491   1        gw=dat%10;//å–å¾—ä¸ªä½æ•°å­—
 492   1        sw=dat/10;//å–å¾—åä½æ•°å­—
 493   1        write_1602com(ner+add);//eræ˜¯å¤´æ–‡ä»¶è§„å®šçš„å€¼0x80+0x40
 494   1        write_1602dat(0x30+sw);//æ•°å­—+30å¾—åˆ°è¯¥æ•°å­—çš„LCD1602æ˜¾ç¤ºç 
 495   1        write_1602dat(0x30+gw);//æ•°å­—+30å¾—åˆ°è¯¥æ•°å­—çš„LCD1602æ˜¾ç¤ºç         
 496   1      }
 497          
 498          //-------------------------------------
 499          //å¹´æœˆæ—¥æ˜¾ç¤ºå­å‡½æ•°
 500          void write_nyr(uchar add,uchar dat)//å‘LCDå†™å¹´æœˆæ—¥ï¼Œæœ‰æ˜¾ç¤ºä½ç½®åŠ æ•°ã€æ˜¾ç¤ºæ•°æ®ï¼Œä¸¤ä¸ªå‚
             -æ•°
 501          {
 502   1        uchar gw,sw;
 503   1        gw=dat%10;//å–å¾—ä¸ªä½æ•°å­—
 504   1        sw=dat/10;//å–å¾—åä½æ•°å­—
 505   1        write_1602com(yh+add);//è®¾å®šæ˜¾ç¤ºä½ç½®ä¸ºç¬¬ä¸€ä¸ªä½ç½®+add
 506   1        write_1602dat(0x30+sw);//æ•°å­—+30å¾—åˆ°è¯¥æ•°å­—çš„LCD1602æ˜¾ç¤ºç 
 507   1        write_1602dat(0x30+gw);//æ•°å­—+30å¾—åˆ°è¯¥æ•°å­—çš„LCD1602æ˜¾ç¤ºç   
 508   1      }
 509          
 510          
 511          
 512          
 513          //-------------------------------------------
 514          void write_week(uchar week)//å†™æ˜ŸæœŸå‡½æ•°
 515          {
 516   1        write_1602com(yh+0x0c);//æ˜ŸæœŸå­—ç¬¦çš„æ˜¾ç¤ºä½ç½®
 517   1        switch(week)
 518   1        {
 519   2          case 1:write_1602dat('M');//æ˜ŸæœŸæ•°ä¸º1æ—¶ï¼Œæ˜¾ç¤º
 520   2               write_1602dat('O');
 521   2               write_1602dat('N');
 522   2                  write_1602dat(' ');
 523   2               break;
 524   2           
 525   2          case 2:write_1602dat('T');//æ˜ŸæœŸæ•°æ®ä¸º2æ—¶æ˜¾ç¤º
 526   2               write_1602dat('U');
 527   2               write_1602dat('E');
 528   2                  write_1602dat(' ');
 529   2               break;
 530   2          
 531   2          case 3:write_1602dat('W');//æ˜ŸæœŸæ•°æ®ä¸º3æ—¶æ˜¾ç¤º
 532   2               write_1602dat('E');
 533   2               write_1602dat('D');
 534   2                  write_1602dat(' ');
 535   2               break;
 536   2          
 537   2          case 4:write_1602dat('T');//æ˜ŸæœŸæ•°æ®ä¸º4æ˜¯æ˜¾ç¤º
 538   2               write_1602dat('H');
 539   2               write_1602dat('U');
 540   2                  write_1602dat(' ');
 541   2               break;
 542   2          
 543   2          case 5:write_1602dat('F');//æ˜ŸæœŸæ•°æ®ä¸º5æ—¶æ˜¾ç¤º
 544   2               write_1602dat('R');
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 10  

 545   2               write_1602dat('I');
 546   2                  write_1602dat(' ');
 547   2               break;
 548   2          
 549   2          case 6:write_1602dat('S');//æ˜ŸæœŸæ•°æ®ä¸º6æ—¶æ˜¾ç¤º
 550   2               write_1602dat('T');
 551   2               write_1602dat('A');
 552   2                  write_1602dat(' ');
 553   2               break;
 554   2          
 555   2          case 0:write_1602dat('S');//æ˜ŸæœŸæ•°æ®ä¸º7æ—¶æ˜¾ç¤º
 556   2               write_1602dat('U');
 557   2               write_1602dat('N');
 558   2                  write_1602dat(' ');
 559   2               break;
 560   2            
 561   2        }
 562   1         
 563   1      }
 564          
 565          
 566          //****************é”®ç›˜æ‰«ææœ‰å…³å‡½æ•°**********************
 567          void keyscan()
 568          {
 569   1        if(seeNL_NZ==0)
 570   1        {
 571   2          delay(9);
 572   2          if(seeNL_NZ==0)
 573   2          {
 574   3            led1=0;
 575   3            if((setn==0)&&(setNZn==0))                //åœ¨æ²¡æœ‰è¿›å…¥è°ƒæ—¶æ¨¡å¼æ—¶æ‰å¯æŒ‰åŠ¨
 576   3            {
 577   4              buzzer=0;//èœ‚é¸£å™¨çŸ­å“ä¸€æ¬¡
 578   4                delay(20);
 579   4                buzzer=1;
 580   4        
 581   4              if(fAlarm==1)
 582   4              {
 583   5                fAlarm=0;
 584   5                     TR1=0;
 585   5                     buzzer=1;   
 586   5              }
 587   4              else
 588   4              {     
 589   5                T_NL_NZ++;
 590   5                     if(T_NL_NZ==2) TR1=1;
 591   5                if(T_NL_NZ==3)
 592   5                {
 593   6                  setn=0;
 594   6                  setNZn=0;
 595   6                  T_NL_NZ=0;  
 596   6                        STPPause=0;STPRun=0;STPMin=0;STPSec=0;STPtime=0;
 597   6                        write_1602com(er+8);
 598   6                        write_1602dat(' ');
 599   6                }
 600   5              }     
 601   4            }
 602   3            while(seeNL_NZ==0);
 603   3               
 604   3               
 605   3          }
 606   2        }
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 11  

 607   1            
 608   1      
 609   1        if((set==0)&&(T_NL_NZ!=2))//---------------setä¸ºåŠŸèƒ½é”®ï¼ˆè®¾ç½®é”®ï¼‰--------------------
 610   1        {
 611   2          delay(9);//å»¶æ—¶ï¼Œç”¨äºæ¶ˆæŠ–åŠ¨
 612   2          if(set==0)//å»¶æ—¶åå†æ¬¡ç¡®è®¤æŒ‰é”®æŒ‰ä¸‹
 613   2          {
 614   3            led1=0;
 615   3      
 616   3      
 617   3              buzzer=0;//èœ‚é¸£å™¨çŸ­å“ä¸€æ¬¡
 618   3              delay(20);
 619   3              buzzer=1;
 620   3            while(!set);
 621   3            if(T_NL_NZ==0x01)     //è¯æ˜æ˜¯å¯¹é—¹é’Ÿè¿›è¡Œè®¾ç½®
 622   3            {
 623   4              setNZn++;
 624   4              if(setNZn==4)     //é—¹é’Ÿè®¾å®šæˆåŠŸï¼Œé€€å›åˆ°æ­£å¸¸æ˜¾ç¤ºå¹¶å¼€å¯é—¹é’Ÿ
 625   4              {
 626   5                setNZn=0;
 627   5                setn=0;TR1=0;
 628   5                timerOn=1;        
 629   5              }
 630   4              switch(setNZn)
 631   4              {
 632   5                case 0:           //æ­£å¸¸æ˜¾ç¤ºæ—¥æœŸæ—¶é—´
 633   5                  write_1602com(0x0c);  //îƒ¤æŸšéœ‰ç—ç“´ç°§äº†?
 634   5                  write_1602com(ner);   //æ—¶é—´æ˜¾ç¤ºå›ºå®šç¬¦å·å†™å…¥ä½ç½®?
 635   5                  for(a=0;a<16;a++)
 636   5                  write_1602dat(NZd[a]);  //å†™æ˜¾ç¤ºæ—¶é—´å›ºå®šç¬¦å·ï¼Œä¸¤ä¸ªå†’å·
 637   5                  
 638   5                  write_nsfm(8,nz_shi); //é—¹é’Ÿ æ—¶
 639   5                  write_nsfm(11,nz_fen);  //é—¹é’Ÿ åˆ†
 640   5                  write_nsfm(14,nz_miao); //é—¹é’Ÿ ç§’
 641   5                  break;
 642   5                case 1:             //é—¹é’Ÿç§’å…‰æ ‡é—ªçƒ   
 643   5                  write_1602com(ner+15);  //è®¾ç½®æŒ‰é”®æŒ‰åŠ¨ä¸€æ¬¡ï¼Œç§’ä½ç½®æ˜¾ç¤ºå…‰æ ‡   //er+0x09;
 644   5                    write_1602com(0x0f);  //è®¾ç½®å…‰æ ‡ä¸ºé—ªçƒ
 645   5                  break;
 646   5                case 2:           //é—¹é’Ÿåˆ†å…‰æ ‡é—ªçƒ 
 647   5                  write_1602com(ner+12);  //è®¾ç½®æŒ‰é”®æŒ‰åŠ¨ä¸€æ¬¡ï¼Œç§’ä½ç½®æ˜¾ç¤ºå…‰æ ‡   //er+0x09;
 648   5                    write_1602com(0x0f);  //è®¾ç½®å…‰æ ‡ä¸ºé—ªçƒ
 649   5                  break;
 650   5                case 3:           //é—¹é’Ÿæ—¶å…‰æ ‡é—ªçƒ 
 651   5                  write_1602com(ner+9); //è®¾ç½®æŒ‰é”®æŒ‰åŠ¨ä¸€æ¬¡ï¼Œç§’ä½ç½®æ˜¾ç¤ºå…‰æ ‡   //er+0x09;
 652   5                    write_1602com(0x0f);  //è®¾ç½®å…‰æ ‡ä¸ºé—ªçƒ
 653   5                  break;  
 654   5              } 
 655   4            }
 656   3      
 657   3            else                //è¯æ˜æ˜¯å¯¹æ—¶é—´åŠæ—¥æœŸè¿›è¡Œè®¾ç½®
 658   3            {
 659   4              if(T_NL_NZ==0)
 660   4              {
 661   5                setn++;
 662   5                if(setn==7)
 663   5                  setn=0;     //è®¾ç½®æŒ‰é”®å…±æœ‰ç§’ã€åˆ†ã€æ—¶ã€æ˜ŸæœŸã€æ—¥ã€æœˆã€å¹´ã€è¿”å›ï¼Œ8ä¸ªåŠŸèƒ½å¾ªç¯
 664   5                switch(setn)
 665   5                {
 666   6            
 667   6                  case 1: TR0=0;//å…³é—­å®šæ—¶å™¨
 668   6                  //TR1=0;
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 12  

 669   6                  write_1602com(er+7);//è®¾ç½®æŒ‰é”®æŒ‰åŠ¨ä¸€æ¬¡ï¼Œç§’ä½ç½®æ˜¾ç¤ºå…‰æ ‡   //er+0x09;
 670   6                    write_1602com(0x0f);//è®¾ç½®å…‰æ ‡ä¸ºé—ªçƒ
 671   6                    temp=(miao)/10*16+(miao)%10;//ç§’æ•°æ®å†™å…¥DS1302
 672   6                    write_1302(0x8e,0x00);
 673   6                    write_1302(0x80,0x80|temp);//miao
 674   6                      write_1302(0x8e,0x80);
 675   6                    break;
 676   6                  case 2:  
 677   6                  write_1602com(er+4);  //æŒ‰2æ¬¡fenä½ç½®æ˜¾ç¤ºå…‰æ ‡   //er+0x06  
 678   6                     //write_1602com(0x0f);
 679   6                  break;
 680   6                  case 3: 
 681   6                  write_1602com(er+1);   //æŒ‰åŠ¨3æ¬¡ï¼Œshi
 682   6                    //write_1602com(0x0f);
 683   6                  break;
 684   6                //  case 4: write_1602com(yh+0x0e);//æŒ‰åŠ¨4æ¬¡ï¼Œweek
 685   6                    //write_1602com(0x0f);
 686   6                //  break;
 687   6                  case 4: write_1602com(yh+0x0a);//æŒ‰åŠ¨4æ¬¡ï¼Œri
 688   6                     //write_1602com(0x0f);
 689   6                  break;
 690   6                  case 5: write_1602com(yh+0x07);//æŒ‰åŠ¨5æ¬¡ï¼Œyue
 691   6                     //write_1602com(0x0f);
 692   6                  break;
 693   6                  case 6: write_1602com(yh+0x04);//æŒ‰åŠ¨6æ¬¡ï¼Œnian
 694   6                     //write_1602com(0x0f);
 695   6                  break;
 696   6                  case 0:
 697   6                  write_1602com(0x0c);//æŒ‰åŠ¨åˆ°ç¬¬7æ¬¡ï¼Œè®¾ç½®å…‰æ ‡ä¸é—ªçƒ
 698   6                  TR0=1;//æ‰“å¼€å®šæ—¶å™¨
 699   6                      temp=(miao)/10*16+(miao)%10;
 700   6                    write_1302(0x8e,0x00);
 701   6                    write_1302(0x80,0x00|temp);//miaoæ•°æ®å†™å…¥DS1302
 702   6                    write_1302(0x8e,0x80);
 703   6                        break;  
 704   6                }                         
 705   5              }
 706   4            }
 707   3          }
 708   2        }
 709   1      //------------------------------åŠ é”®add----------------------------   
 710   1        if((setn!=0)&&(setNZn==0))//å½“setæŒ‰ä¸‹ä»¥ä¸‹ã€‚å†æŒ‰ä»¥ä¸‹é”®æ‰æœ‰æ•ˆï¼ˆæŒ‰é”®æ¬¡æ•°ä¸ç­‰äºé›¶ï¼‰
 711   1        {
 712   2          if(add==0)  //ä¸Šè°ƒé”®
 713   2          {
 714   3            delay(10);
 715   3            if(add==0)
 716   3            {
 717   4              led1=0;
 718   4      
 719   4      
 720   4                buzzer=0;//èœ‚é¸£å™¨çŸ­å“ä¸€æ¬¡
 721   4                delay(20);
 722   4                buzzer=1;
 723   4              while(!add);
 724   4              switch(setn)
 725   4              {
 726   5                case 1:miao++;//è®¾ç½®é”®æŒ‰åŠ¨1æ¬¡ï¼Œè°ƒç§’
 727   5                    if(miao==60)
 728   5                      miao=0;//ç§’è¶…è¿‡59ï¼Œå†åŠ 1ï¼Œå°±å½’é›¶
 729   5                    write_sfm(0x06,miao);//ä»¤LCDåœ¨æ­£ç¡®ä½ç½®æ˜¾ç¤º"åŠ "è®¾å®šå¥½çš„ç§’æ•°
 730   5                    temp=(miao)/10*16+(miao)%10;//åè¿›åˆ¶è½¬æ¢æˆDS1302è¦æ±‚çš„DCBç 
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 13  

 731   5                      write_1302(0x8e,0x00); //å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤ 
 732   5                      write_1302(0x80,temp); //å‘DS1302å†…å†™ç§’å¯„å­˜å™¨80Hå†™å…¥è°ƒæ•´åçš„ç§’æ•°æ®BCDç 
 733   5                      write_1302(0x8e,0x80); //æ‰“å¼€å†™ä¿æŠ¤
 734   5                    write_1602com(er+7);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼Œå…‰æ ‡è‡ªåŠ¨å³ç§»ï¼Œæ‰€ä»¥è¦
             -æŒ‡å®šè¿”å›
 735   5                    //write_1602com(0x0b);
 736   5                    break;
 737   5                case 2:fen++;
 738   5                    if(fen==60)
 739   5                      fen=0;
 740   5                    write_sfm(0x03,fen);//ä»¤LCDåœ¨æ­£ç¡®ä½ç½®æ˜¾ç¤º"åŠ "è®¾å®šå¥½çš„åˆ†æ•°æ®
 741   5                    temp=(fen)/10*16+(fen)%10;//åè¿›åˆ¶è½¬æ¢æˆDS1302è¦æ±‚çš„DCBç 
 742   5                      write_1302(0x8e,0x00);//å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤ 
 743   5                      write_1302(0x82,temp);//å‘DS1302å†…å†™åˆ†å¯„å­˜å™¨82Hå†™å…¥è°ƒæ•´åçš„åˆ†æ•°æ®BCDç 
 744   5                      write_1302(0x8e,0x80);//æ‰“å¼€å†™ä¿æŠ¤
 745   5                    write_1602com(er+4);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œåœ¨è¿™é‡
             -Œæ˜¯å†™å›åŸæ¥çš„ä½ç½®
 746   5                    break;
 747   5                case 3:shi++;
 748   5                    if(shi==24)
 749   5                      shi=0;
 750   5                    write_sfm(0x00,shi);//ä»¤LCDåœ¨æ­£ç¡®çš„ä½ç½®æ˜¾ç¤º"åŠ "è®¾å®šå¥½çš„å°æ—¶æ•°æ®
 751   5                    temp=(shi)/10*16+(shi)%10;//åè¿›åˆ¶è½¬æ¢æˆDS1302è¦æ±‚çš„DCBç 
 752   5                      write_1302(0x8e,0x00);//å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤ 
 753   5                      write_1302(0x84,temp);//å‘DS1302å†…å†™å°æ—¶å¯„å­˜å™¨84Hå†™å…¥è°ƒæ•´åçš„å°æ—¶æ•°æ®BCDç 
 754   5                      write_1302(0x8e,0x80);//æ‰“å¼€å†™ä¿æŠ¤
 755   5                    write_1602com(er+1);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œæ‰€ä»¥éœ
             -€è¦å…‰æ ‡å›ä½
 756   5                    break;
 757   5                /*
 758   5                case 4:week++;
 759   5                    if(week==8)
 760   5                      week=1;
 761   5                          write_1602com(yh+0x0C);//æŒ‡å®š'åŠ 'åçš„å‘¨æ•°æ®æ˜¾ç¤ºä½ç½®
 762   5                      write_week(week);//æŒ‡å®šå‘¨æ•°æ®æ˜¾ç¤ºå†…å®¹
 763   5                          temp=(week)/10*16+(week)%10;//åè¿›åˆ¶è½¬æ¢æˆDS1302è¦æ±‚çš„DCBç 
 764   5                      write_1302(0x8e,0x00);//å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤ 
 765   5                      write_1302(0x8a,temp);//å‘DS1302å†…å†™å‘¨å¯„å­˜å™¨8aHå†™å…¥è°ƒæ•´åçš„å‘¨æ•°æ®BCDç 
 766   5                      write_1302(0x8e,0x80);//æ‰“å¼€å†™ä¿æŠ¤
 767   5                       write_1602com(yh+0x0e);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œæ‰
             -€ä»¥éœ€è¦å…‰æ ‡å›ä½
 768   5                    break;
 769   5                */
 770   5                case 4:ri++;
 771   5                    if((yue==12)||(yue==10)||(yue==8)||(yue==7)||(yue==5)||(yue==3)||(yue==1))
 772   5                        {
 773   6                           if(ri>=32)  ri=1;
 774   6                        }  
 775   5                        else if(yue!=2)
 776   5                        {
 777   6                           if(ri>=31)  ri=1;
 778   6                        }
 779   5                  else
 780   5                        {
 781   6                           if(((nian%4)==0))
 782   6                    {
 783   7                              if(nian%100==0)
 784   7                              {
 785   8                                 if((nian%400)==0) if(ri==30)  ri=1;
 786   8                                 else if(ri>=29)  ri=1;
 787   8                              }
 788   7                              else if(ri>29)  ri=1;
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 14  

 789   7                           }
 790   6                           else if(ri>=29)  ri=1;
 791   6                        }
 792   5                    Conver_week(nian,yue,ri);
 793   5                    write_week(week);
 794   5                    write_nyr(9,ri);//ä»¤LCDåœ¨æ­£ç¡®çš„ä½ç½®æ˜¾ç¤º"åŠ "è®¾å®šå¥½çš„æ—¥æœŸæ•°æ®
 795   5                    temp=(ri)/10*16+(ri)%10;//åè¿›åˆ¶è½¬æ¢æˆDS1302è¦æ±‚çš„DCBç 
 796   5                      write_1302(0x8e,0x00);//å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤
 797   5                      write_1302(0x86,temp);//å‘DS1302å†…å†™æ—¥æœŸå¯„å­˜å™¨86Hå†™å…¥è°ƒæ•´åçš„æ—¥æœŸæ•°æ®BCDç 
 798   5                      write_1302(0x8e,0x80);//æ‰“å¼€å†™ä¿æŠ¤
 799   5                    write_1602com(yh+10);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œæ‰€ä»¥é
             -œ€è¦å…‰æ ‡å›ä½
 800   5              
 801   5                    break;
 802   5                case 5:yue++;
 803   5                    if(yue==13) yue=1;
 804   5                           if((yue==11)||(yue==9)||(yue==6)||(yue==4))
 805   5                           {
 806   6                              if(ri>30)  {ri=30;write_nyr(9,ri);}//ä»¤LCDåœ¨æ­£ç¡®çš„ä½ç½®æ˜¾ç¤º"åŠ "è®¾å®šå¥½ç
             -š„æ—¥æœŸæ•°æ®
 807   6                           }  
 808   5                           else if(yue==2)
 809   5                           {
 810   6                              if(((nian%4)==0))
 811   6                              {
 812   7                                 if(nian%100==0)
 813   7                                 {
 814   8                                    if((nian%400)==0) 
 815   8                                    {
 816   9                                       if(ri>29)
 817   9                                       {ri=29;write_nyr(9,ri);}
 818   9                                    }
 819   8                                 }
 820   7                                 else if(ri>29) {ri=29;write_nyr(9,ri);}
 821   7                              }
 822   6                              else if(ri>28)  {ri=28;write_nyr(9,ri);}
 823   6                              
 824   6                           }
 825   5                    Conver_week(nian,yue,ri);
 826   5                    write_week(week);
 827   5                    write_nyr(6,yue);//ä»¤LCDåœ¨æ­£ç¡®çš„ä½ç½®æ˜¾ç¤º"åŠ "è®¾å®šå¥½çš„æœˆä»½æ•°æ®
 828   5                    temp=(yue)/10*16+(yue)%10;//åè¿›åˆ¶è½¬æ¢æˆDS1302è¦æ±‚çš„DCBç 
 829   5                      write_1302(0x8e,0x00);//å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤
 830   5                      write_1302(0x88,temp);//å‘DS1302å†…å†™æœˆä»½å¯„å­˜å™¨88Hå†™å…¥è°ƒæ•´åçš„æœˆä»½æ•°æ®BCDç 
 831   5                      write_1302(0x8e,0x80);//æ‰“å¼€å†™ä¿æŠ¤
 832   5                    write_1602com(yh+7);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œæ‰€ä»¥éœ
             -€è¦å…‰æ ‡å›ä½
 833   5              
 834   5                    break;
 835   5                case 6:nian++;
 836   5                   if(nian==100)
 837   5                    nian=0;
 838   5                           if(yue==2)
 839   5                           {
 840   6                              if(((nian%4)==0))
 841   6                              {
 842   7                                 if(nian%100==0)
 843   7                                 {
 844   8                                    if((nian%400)==0) 
 845   8                                    {
 846   9                                       if(ri>29)
 847   9                                       {ri=29;write_nyr(9,ri);}
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 15  

 848   9                                    }
 849   8                                 }
 850   7                                 else if(ri>29) {ri=29;write_nyr(9,ri);}
 851   7                              }
 852   6                              else if(ri>28)  {ri=28;write_nyr(9,ri);}
 853   6                              
 854   6                           }
 855   5                    Conver_week(nian,yue,ri);
 856   5                    write_week(week);
 857   5                    write_nyr(3,nian);//ä»¤LCDåœ¨æ­£ç¡®çš„ä½ç½®æ˜¾ç¤º"åŠ "è®¾å®šå¥½çš„å¹´ä»½æ•°æ®
 858   5                          temp=(nian)/10*16+(nian)%10;//åè¿›åˆ¶è½¬æ¢æˆDS1302è¦æ±‚çš„DCBç 
 859   5                      write_1302(0x8e,0x00);//å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤
 860   5                      write_1302(0x8c,temp);//å‘DS1302å†…å†™å¹´ä»½å¯„å­˜å™¨8cHå†™å…¥è°ƒæ•´åçš„å¹´ä»½æ•°æ®BCDç 
 861   5                      write_1302(0x8e,0x80);//æ‰“å¼€å†™ä¿æŠ¤
 862   5                    write_1602com(yh+4);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œæ‰€ä»¥éœ
             -€è¦å…‰æ ‡å›ä½
 863   5              
 864   5                    break;
 865   5              }
 866   4            }
 867   3        
 868   3          }
 869   2          //------------------å‡é”®decï¼Œå„å¥åŠŸèƒ½å‚ç…§'åŠ é”®'æ³¨é‡Š---------------
 870   2          if(dec==0)
 871   2          {
 872   3            delay(10);//è°ƒå»¶æ—¶ï¼Œæ¶ˆæŠ–åŠ¨
 873   3            if(dec==0)
 874   3            {
 875   4              led1=0;
 876   4      
 877   4      
 878   4                buzzer=0;//èœ‚é¸£å™¨çŸ­å“ä¸€æ¬¡
 879   4                delay(20);
 880   4                buzzer=1;
 881   4              while(!dec);
 882   4              switch(setn)
 883   4              {
 884   5                case 1:
 885   5                  miao--;
 886   5                  if(miao==-1)
 887   5                    miao=59;//ç§’æ•°æ®å‡åˆ°-1æ—¶è‡ªåŠ¨å˜æˆ59
 888   5                  write_sfm(0x06,miao);//åœ¨LCDçš„æ­£ç¡®ä½ç½®æ˜¾ç¤ºæ”¹å˜åæ–°çš„ç§’æ•°
 889   5                        temp=(miao)/10*16+(miao)%10;//åè¿›åˆ¶è½¬æ¢æˆDS1302è¦æ±‚çš„DCBç 
 890   5                    write_1302(0x8e,0x00); //å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤ 
 891   5                    write_1302(0x80,temp); //å‘DS1302å†…å†™ç§’å¯„å­˜å™¨80Hå†™å…¥è°ƒæ•´åçš„ç§’æ•°æ®BCDç 
 892   5                    write_1302(0x8e,0x80); //æ‰“å¼€å†™ä¿æŠ¤
 893   5                  write_1602com(er+7);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œåœ¨è¿™é‡Œ
             -æ˜¯å†™å›åŸæ¥çš„ä½ç½®
 894   5                  //write_1602com(0x0b);
 895   5                  break;
 896   5                case 2:
 897   5                  fen--;
 898   5                  if(fen==-1)
 899   5                  fen=59;
 900   5                  write_sfm(3,fen);
 901   5                  temp=(fen)/10*16+(fen)%10;//åè¿›åˆ¶è½¬æ¢æˆDS1302è¦æ±‚çš„DCBç 
 902   5                    write_1302(0x8e,0x00);//å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤ 
 903   5                    write_1302(0x82,temp);//å‘DS1302å†…å†™åˆ†å¯„å­˜å™¨82Hå†™å…¥è°ƒæ•´åçš„åˆ†æ•°æ®BCDç 
 904   5                    write_1302(0x8e,0x80);//æ‰“å¼€å†™ä¿æŠ¤
 905   5                  write_1602com(er+4);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œåœ¨è¿™é‡Œ
             -æ˜¯å†™å›åŸæ¥çš„ä½ç½®
 906   5                  break;
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 16  

 907   5        
 908   5                case 3:
 909   5                  shi--;
 910   5                    if(shi==-1)
 911   5                  shi=23;
 912   5                  write_sfm(0,shi);
 913   5                  temp=(shi)/10*16+(shi)%10;//åè¿›åˆ¶è½¬æ¢æˆDS1302è¦æ±‚çš„DCBç 
 914   5                    write_1302(0x8e,0x00);//å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤ 
 915   5                    write_1302(0x84,temp);//å‘DS1302å†…å†™å°æ—¶å¯„å­˜å™¨84Hå†™å…¥è°ƒæ•´åçš„å°æ—¶æ•°æ®BCDç 
 916   5                    write_1302(0x8e,0x80);//æ‰“å¼€å†™ä¿æŠ¤
 917   5                  write_1602com(er+1);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œæ‰€ä»¥éœ€
             -è¦å…‰æ ‡å›ä½
 918   5                  break;
 919   5            
 920   5                case 4:
 921   5                  ri--;
 922   5                  if((yue==12)||(yue==10)||(yue==8)||(yue==7)||(yue==5)||(yue==3)||(yue==1))
 923   5                        {
 924   6                           if(ri==0)  ri=31;
 925   6                        }  
 926   5                        else if(yue!=2)
 927   5                        {
 928   6                           if(ri==0)  ri=30;
 929   6                        }
 930   5                  else
 931   5                        {
 932   6                           if(((nian%4)==0))
 933   6                    {
 934   7                              if(nian%100==0)
 935   7                              {
 936   8                                 if((nian%400)==0) if(ri==0)  ri=29;
 937   8                                 else if(ri==0)  ri=28;
 938   8                              }
 939   7                              else if(ri==0)  ri=29;
 940   7                           }
 941   6                           else if(ri==0)  ri=28;
 942   6                        }
 943   5                  Conver_week(nian,yue,ri);
 944   5                  write_week(week);
 945   5                  write_nyr(9,ri);
 946   5                  temp=(ri)/10*16+(ri)%10;//åè¿›åˆ¶è½¬æ¢æˆDS1302è¦æ±‚çš„DCBç 
 947   5                    write_1302(0x8e,0x00);//å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤
 948   5                    write_1302(0x86,temp);//å‘DS1302å†…å†™æ—¥æœŸå¯„å­˜å™¨86Hå†™å…¥è°ƒæ•´åçš„æ—¥æœŸæ•°æ®BCDç 
 949   5                    write_1302(0x8e,0x80);//æ‰“å¼€å†™ä¿æŠ¤
 950   5                  write_1602com(yh+10);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œæ‰€ä»¥éœ
             -€è¦å…‰æ ‡å›ä½    
 951   5                  break;
 952   5                case 5:
 953   5                  yue--;
 954   5                        if(yue==0)
 955   5                  yue=12;
 956   5      
 957   5                        if((yue==11)||(yue==9)||(yue==6)||(yue==4))
 958   5                           {
 959   6                              if(ri>30)  {ri=30;write_nyr(9,ri);}//ä»¤LCDåœ¨æ­£ç¡®çš„ä½ç½®æ˜¾ç¤º"åŠ "è®¾å®šå¥½ç
             -š„æ—¥æœŸæ•°æ®
 960   6                           }  
 961   5                           else if(yue==2)
 962   5                           {
 963   6                              if(((nian%4)==0))
 964   6                              {
 965   7                                 if(nian%100==0)
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 17  

 966   7                                 {
 967   8                                    if((nian%400)==0) 
 968   8                                    {
 969   9                                       if(ri>29)
 970   9                                       {ri=29;write_nyr(9,ri);}
 971   9                                    }
 972   8                                 }
 973   7                                 else if(ri>29) {ri=29;write_nyr(9,ri);}
 974   7                              }
 975   6                              else if(ri>28)  {ri=28;write_nyr(9,ri);}
 976   6                              
 977   6                           }
 978   5                  Conver_week(nian,yue,ri);
 979   5                  write_week(week);
 980   5                  write_nyr(6,yue);
 981   5                  temp=(yue)/10*16+(yue)%10;//åè¿›åˆ¶è½¬æ¢æˆDS1302è¦æ±‚çš„DCBç 
 982   5                    write_1302(0x8e,0x00);//å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤
 983   5                    write_1302(0x88,temp);//å‘DS1302å†…å†™æœˆä»½å¯„å­˜å™¨88Hå†™å…¥è°ƒæ•´åçš„æœˆä»½æ•°æ®BCDç 
 984   5                    write_1302(0x8e,0x80);//æ‰“å¼€å†™ä¿æŠ¤
 985   5                  write_1602com(yh+7);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œæ‰€ä»¥éœ€
             -è¦å…‰æ ‡å›ä½
 986   5            
 987   5                  break;  
 988   5                case 6:
 989   5                  nian--;
 990   5                  if(nian==-1)
 991   5                  nian=99;
 992   5                        if(nian==100)
 993   5                    nian=0;
 994   5                           if(yue==2)
 995   5                           {
 996   6                              if(((nian%4)==0))
 997   6                              {
 998   7                                 if(nian%100==0)
 999   7                                 {
1000   8                                    if((nian%400)==0) 
1001   8                                    {
1002   9                                       if(ri>29)
1003   9                                       {ri=29;write_nyr(9,ri);}
1004   9                                    }
1005   8                                 }
1006   7                                 else if(ri>29) {ri=29;write_nyr(9,ri);}
1007   7                              }
1008   6                              else if(ri>28)  {ri=28;write_nyr(9,ri);}
1009   6                              
1010   6                           }
1011   5                  Conver_week(nian,yue,ri);
1012   5                  write_week(week);
1013   5                  write_nyr(3,nian);
1014   5                      temp=(nian)/10*16+(nian)%10;//åè¿›åˆ¶è½¬æ¢æˆDS1302è¦æ±‚çš„DCBç 
1015   5                    write_1302(0x8e,0x00);//å…è®¸å†™ï¼Œç¦æ­¢å†™ä¿æŠ¤
1016   5                    write_1302(0x8c,temp);//å‘DS1302å†…å†™å¹´ä»½å¯„å­˜å™¨8cHå†™å…¥è°ƒæ•´åçš„å¹´ä»½æ•°æ®BCDç 
1017   5                    write_1302(0x8e,0x80);//æ‰“å¼€å†™ä¿æŠ¤
1018   5                  write_1602com(yh+4);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œæ‰€ä»¥éœ€
             -è¦å…‰æ ‡å›ä½
1019   5                  break;
1020   5                      
1021   5              }
1022   4            }
1023   3          }
1024   2        }
1025   1        if((setNZn!=0)&&(setn==0))
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 18  

1026   1        {
1027   2          if(add==0)  //ä¸Šè°ƒé”®
1028   2          {
1029   3            delay(10);
1030   3            if(add==0)
1031   3            {
1032   4              led1=0;
1033   4      
1034   4      
1035   4                buzzer=0;//èœ‚é¸£å™¨çŸ­å“ä¸€æ¬¡
1036   4                delay(20);
1037   4                buzzer=1;
1038   4              while(!add);
1039   4              switch(setNZn)
1040   4              {
1041   5                case 1:
1042   5                  nz_miao++;        //è®¾ç½®é”®æŒ‰åŠ¨1æ¬¡ï¼Œè°ƒç§’
1043   5                  if(nz_miao==60)
1044   5                    nz_miao=0;//ç§’è¶…è¿‡59ï¼Œå†åŠ 1ï¼Œå°±å½’é›¶
1045   5                  write_nsfm(14,nz_miao);//ä»¤LCDåœ¨æ­£ç¡®ä½ç½®æ˜¾ç¤º"åŠ "è®¾å®šå¥½çš„ç§’æ•°
1046   5                  write_1602com(ner+15);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼Œå…‰æ ‡è‡ªåŠ¨å³ç§»ï¼Œæ‰€ä»¥è
             -¦æŒ‡å®šè¿”å›
1047   5                  break;
1048   5                case 2:
1049   5                  nz_fen++;
1050   5                  if(nz_fen==60)
1051   5                    nz_fen=0;
1052   5                  write_nsfm(11,nz_fen);//ä»¤LCDåœ¨æ­£ç¡®ä½ç½®æ˜¾ç¤º"åŠ "è®¾å®šå¥½çš„åˆ†æ•°æ®
1053   5                  write_1602com(ner+12);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œåœ¨è¿™é
             -‡Œæ˜¯å†™å›åŸæ¥çš„ä½ç½®
1054   5                  break;
1055   5                case 3:
1056   5                  nz_shi++;
1057   5                  if(nz_shi==24)
1058   5                    nz_shi=0;
1059   5                  write_nsfm(8,nz_shi);//ä»¤LCDåœ¨æ­£ç¡®çš„ä½ç½®æ˜¾ç¤º"åŠ "è®¾å®šå¥½çš„å°æ—¶æ•°æ®
1060   5                  write_1602com(ner+9);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œæ‰€ä»¥éœ
             -€è¦å…‰æ ‡å›ä½
1061   5                  break;
1062   5              }
1063   4            }
1064   3        
1065   3          }
1066   2          //------------------å‡é”®decï¼Œå„å¥åŠŸèƒ½å‚ç…§'åŠ é”®'æ³¨é‡Š---------------
1067   2          if(dec==0)
1068   2          {
1069   3            delay(10);//è°ƒå»¶æ—¶ï¼Œæ¶ˆæŠ–åŠ¨
1070   3            if(dec==0)
1071   3            {
1072   4              led1=0;
1073   4      
1074   4      
1075   4                buzzer=0;//èœ‚é¸£å™¨çŸ­å“ä¸€æ¬¡
1076   4                delay(20);
1077   4                buzzer=1;
1078   4              while(!dec);
1079   4              switch(setNZn)
1080   4              {
1081   5                case 1:
1082   5                  nz_miao--;
1083   5                  if(nz_miao==-1)
1084   5                    nz_miao=59;//ç§’æ•°æ®å‡åˆ°-1æ—¶è‡ªåŠ¨å˜æˆ59
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 19  

1085   5                  write_nsfm(14,nz_miao);//åœ¨LCDçš„æ­£ç¡®ä½ç½®æ˜¾ç¤ºæ”¹å˜åæ–°çš„ç§’æ•°
1086   5                  write_1602com(ner+15);
1087   5                  break;
1088   5                case 2:
1089   5                  nz_fen--;
1090   5                  if(nz_fen==-1)
1091   5                    nz_fen=59;
1092   5                  write_nsfm(11,nz_fen);
1093   5                  write_1602com(ner+12);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œåœ¨è¿™é
             -‡Œæ˜¯å†™å›åŸæ¥çš„ä½ç½®
1094   5                  break;
1095   5        
1096   5                case 3:
1097   5                  nz_shi--;
1098   5                    if(nz_shi==-1)
1099   5                  nz_shi=23;
1100   5                  write_nsfm(8,nz_shi);
1101   5                  write_1602com(ner+9);//å› ä¸ºè®¾ç½®æ¶²æ™¶çš„æ¨¡å¼æ˜¯å†™å…¥æ•°æ®åï¼ŒæŒ‡é’ˆè‡ªåŠ¨åŠ ä¸€ï¼Œæ‰€ä»¥éœ
             -€è¦å…‰æ ‡å›ä½
1102   5                  break;
1103   5                      
1104   5              }
1105   4            }
1106   3          }
1107   2        } 
1108   1         
1109   1         if((T_NL_NZ==2))
1110   1         {
1111   2            
1112   2          if(set==0)
1113   2            {
1114   3               delay(10);//è°ƒå»¶æ—¶ï¼Œæ¶ˆæŠ–åŠ¨
1115   3               if(set==0)  
1116   3               {
1117   4                  STPRun=!STPRun;
1118   4                  if(STPRun==0)  {STPPause=0;STPMin=0;STPSec=0;STPtime=0;}
1119   4                  else STPPause=1;
1120   4               }
1121   3            }
1122   2            while(set==0);
1123   2            
1124   2            if(add==0)
1125   2            {
1126   3               delay(10);//è°ƒå»¶æ—¶ï¼Œæ¶ˆæŠ–åŠ¨
1127   3               if(add==0)  
1128   3               {
1129   4                  if(STPPause==1)  STPRun=!STPRun;
1130   4               }
1131   3            }
1132   2            while(add==0);
1133   2            
1134   2            if(dec==0)
1135   2            {
1136   3               delay(10);//è°ƒå»¶æ—¶ï¼Œæ¶ˆæŠ–åŠ¨
1137   3               if(dec==0)  {STPMin=0;STPSec=0;STPtime=0;}
1138   3            }
1139   2            while(dec==0);
1140   2         }
1141   1      }
1142          
1143          //-------------------------------
1144          void init(void)   //å®šæ—¶å™¨ã€è®¡æ•°å™¨è®¾ç½®å‡½æ•°
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 20  

1145          {
1146   1        TMOD=0x11;    //æŒ‡å®šå®šæ—¶/è®¡æ•°å™¨çš„å·¥ä½œæ–¹å¼ä¸º3
1147   1        TH0=0;//(65535-50000)/256;      //å®šæ—¶å™¨T0çš„é«˜å››ä½=0
1148   1        TL0=0;//(65535-50000)%256;      //å®šæ—¶å™¨T0çš„ä½å››ä½=0
1149   1        TH1=(65535-10000)/256; //TH0T;//0x3C;
1150   1        TL1=(65535-10000)%256; //TL0T;//0xB0;
1151   1        EA=1;       //ç³»ç»Ÿå…è®¸æœ‰å¼€æ”¾çš„ä¸­æ–­
1152   1        ET0=1;      //å…è®¸T0ä¸­æ–­
1153   1        ET1=1;
1154   1        IT1=1;
1155   1        IT0=0;
1156   1        TR0=1;      //å¼€å¯ä¸­æ–­ï¼Œå¯åŠ¨å®šæ—¶å™¨
1157   1        TR1=0;
1158   1      }
1159          
1160          
1161          void alarm(void)
1162          {
1163   1        if((shi==nz_shi)&&(fen==nz_fen)&&(miao==0))
1164   1        {
1165   2            fAlarm=1;TR1=1;
1166   2        }
1167   1        if((shi==nz_shi)&&(fen==(nz_fen+1)))
1168   1        {
1169   2          fAlarm=0;TR1=0;
1170   2          buzzer=1;
1171   2        }
1172   1      }
1173          
1174          
1175          void ZD_baoshi(void)
1176          {
1177   1        buzzer=0;
1178   1        delay(5);
1179   1        buzzer=1;
1180   1        bsn++;
1181   1        if(bsn==temp_hour)
1182   1        {
1183   2          baoshi=0;
1184   2        }
1185   1      }
1186          
1187          //*******************ä¸»å‡½æ•°**************************
1188          //***************************************************
1189          void main()
1190          {
1191   1        P1=0xff;
1192   1        lcd_init();      //è°ƒç”¨æ¶²æ™¶å±åˆå§‹åŒ–å­å‡½æ•°
1193   1        ds1302_init();   //è°ƒç”¨DS1302æ—¶é’Ÿçš„åˆå§‹åŒ–å­å‡½æ•°
1194   1        init();          //è°ƒç”¨å®šæ—¶è®¡æ•°å™¨çš„è®¾ç½®å­å‡½æ•°
1195   1        led=1;           //æ‰“å¼€LCDçš„èƒŒå…‰ç”µæº
1196   1          buzzer=0;    //èœ‚é¸£å™¨é•¿å“ä¸€æ¬¡
1197   1          delay(80);
1198   1          buzzer=1;
1199   1        while(1)  //æ— é™å¾ªç¯ä¸‹é¢çš„è¯­å¥ï¼š
1200   1        {    
1201   2            keyscan();      //è°ƒç”¨é”®ç›˜æ‰«æå­å‡½æ•° 
1202   2               led=led1;
1203   2               if(timerOn==1)
1204   2            alarm();  //é—¹é’Ÿè¾“å‡º
1205   2               if((fen==0)&&(miao==0))
1206   2               {
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 21  

1207   3                  if(shi>12)
1208   3                     temp_hour=shi-12;
1209   3                  else
1210   3                  {
1211   4                     if(shi==0)  temp_hour=12;
1212   4                     else  temp_hour=shi;
1213   4                  }
1214   3                  shangyimiao=miao;
1215   3                  baoshi=1;
1216   3               }
1217   2               if(baoshi==1)
1218   2               {
1219   3                  ZD_baoshi();
1220   3                  do 
1221   3                     keyscan();
1222   3                  while(shangyimiao==miao); 
1223   3                  shangyimiao=miao;
1224   3               }
1225   2          }
1226   1      }
1227          
1228          
1229          void timer0() interrupt 1  //å–å¾—å¹¶æ˜¾ç¤ºæ—¥å†å’Œæ—¶é—´
1230          {
1231   1        //è¯»å–ç§’æ—¶åˆ†å‘¨æ—¥æœˆå¹´ä¸ƒä¸ªæ•°æ®ï¼ˆDS1302çš„è¯»å¯„å­˜å™¨ä¸å†™å¯„å­˜å™¨ä¸ä¸€æ ·ï¼‰ï¼š
1232   1            if(T_NL_NZ!=2)
1233   1            {
1234   2            miao = BCD_Decimal(read_1302(0x81));
1235   2            fen = BCD_Decimal(read_1302(0x83));
1236   2            shi  = BCD_Decimal(read_1302(0x85));
1237   2            ri  = BCD_Decimal(read_1302(0x87));
1238   2            yue = BCD_Decimal(read_1302(0x89));
1239   2            nian=BCD_Decimal(read_1302(0x8d));
1240   2        //week=BCD_Decimal(read_1302(0x8b));     //ä¸è¯»å–ï¼Œç›´æ¥é€šè¿‡æ—¥æœŸè®¡ç®—å¾—åˆ°
1241   2            if((led1==0))
1242   2            {
1243   3               if(temp_miao!=miao)
1244   3               {
1245   4                  temp_miao=miao;
1246   4      
1247   4               }
1248   3            }
1249   2      
1250   2      
1251   2            if(T_NL_NZ==1)                //æ˜¾ç¤ºé—¹é’Ÿæ—¶é—´ï¼Œ
1252   2            {
1253   3               write_1602com(ner);//æ—¶é—´æ˜¾ç¤ºå›ºå®šç¬¦å·å†™å…¥ä½ç½®?
1254   3               for(a=0;a<16;a++)
1255   3                  write_1602dat(NZd[a]);//å†™æ˜¾ç¤ºæ—¶é—´å›ºå®šç¬¦å·ï¼Œä¸¤ä¸ªå†’å·
1256   3      
1257   3               write_nsfm(8,nz_shi);//å†œå† å¹´
1258   3               write_nsfm(11,nz_fen);//å†œå† æœˆ
1259   3               write_nsfm(14,nz_miao);//å†œå† æ—¥
1260   3      
1261   3               do
1262   3                  keyscan();
1263   3               while(T_NL_NZ==1);
1264   3      
1265   3               write_1602com(ner);//æ—¶é—´æ˜¾ç¤ºå›ºå®šç¬¦å·å†™å…¥ä½ç½®ï¼Œä»ç¬¬2ä¸ªä½ç½®åå¼€å§‹æ˜¾ç¤º
1266   3               for(a=0;a<16;a++)
1267   3               {
1268   4                  write_1602dat(qk[a]);//å†™æ˜¾ç¤ºæ—¶é—´å›ºå®šç¬¦å·ï¼Œä¸¤ä¸ªå†’å·
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 22  

1269   4               }
1270   3      
1271   3               write_1602com(er);//æ—¶é—´æ˜¾ç¤ºå›ºå®šç¬¦å·å†™å…¥ä½ç½®ï¼Œä»ç¬¬2ä¸ªä½ç½®åå¼€å§‹æ˜¾ç¤º
1272   3               for(a=0;a<8;a++)
1273   3               {
1274   4                  write_1602dat(tab2[a]);//å†™æ˜¾ç¤ºæ—¶é—´å›ºå®šç¬¦å·ï¼Œä¸¤ä¸ªå†’å·
1275   4               }
1276   3            }
1277   2      
1278   2            else //if(T_NL_NZ==0)
1279   2            { 
1280   3               setn=0;
1281   3            setNZn=0;
1282   3            T_NL_NZ=0;
1283   3               //æ˜¾ç¤ºç§’ã€æ—¶ã€åˆ†æ•°æ®ï¼š 
1284   3               
1285   3               write_sfm(6,miao);//ç§’ï¼Œä»ç¬¬äºŒè¡Œç¬¬8ä¸ªå­—åå¼€å§‹æ˜¾ç¤ºï¼ˆè°ƒç”¨æ—¶åˆ†ç§’æ˜¾ç¤ºå­å‡½æ•°ï
             -¼‰
1286   3               write_sfm(3,fen);//åˆ†ï¼Œä»ç¬¬äºŒè¡Œç¬¬5ä¸ªå­—ç¬¦åå¼€å§‹æ˜¾ç¤º
1287   3               write_sfm(0,shi);//å°æ—¶ï¼Œä»ç¬¬äºŒè¡Œç¬¬2ä¸ªå­—ç¬¦åå¼€å§‹æ˜¾ç¤º
1288   3            } 
1289   2          //æ˜¾ç¤ºæ—¥ã€æœˆã€å¹´æ•°æ®ï¼š
1290   2               write_nyr(9,ri);//æ—¥æœŸï¼Œä»ç¬¬äºŒè¡Œç¬¬9ä¸ªå­—ç¬¦åå¼€å§‹æ˜¾ç¤º
1291   2            write_nyr(6,yue);//æœˆä»½ï¼Œä»ç¬¬äºŒè¡Œç¬¬6ä¸ªå­—ç¬¦åå¼€å§‹æ˜¾ç¤º
1292   2               write_nyr(3,nian);//å¹´ï¼Œä»ç¬¬äºŒè¡Œç¬¬3ä¸ªå­—ç¬¦åå¼€å§‹æ˜¾ç¤º
1293   2               Conver_week(nian,yue,ri);
1294   2               write_week(week);
1295   2         }
1296   1         else 
1297   1         {
1298   2            
1299   2          //if(STPtime!=oSTPtime)
1300   2            {
1301   3               oSTPtime=STPtime;
1302   3               write_1602com(er);
1303   3               write_1602dat(STPMin/10+'0');
1304   3               write_1602dat(STPMin%10+'0');
1305   3               write_1602dat(':');
1306   3               write_1602dat(STPSec/10+'0');
1307   3               write_1602dat(STPSec%10+'0');
1308   3               write_1602dat(':');
1309   3               //write_1602dat(STPtime/100+'0');
1310   3               write_1602dat(STPtime%100/10+'0');
1311   3               write_1602dat(STPtime%10+'0');
1312   3            }
1313   2            
1314   2         }
1315   1      }
1316          
1317          
1318          
1319          unsigned char count1;
1320          
1321          void timer1() interrupt 3  //å–å¾—å¹¶æ˜¾ç¤ºæ—¥å†å’Œæ—¶é—´
1322          {
1323   1        //TH1=(65535-1000)/256; //TH0T;//0x3C;
1324   1        //TL1=(65535-1000)%256; //TL0T;//0xB0;
1325   1      
1326   1         TH1=(65535-10000)/256; //TH0T;//0x3C;
1327   1        TL1=(65535-10000)%256; //TL0T;//0xB0;
1328   1         //P37=!P37;
1329   1        TR1=1;
C51 COMPILER V9.60.0.0   MAIN                                                              09/24/2022 18:27:02 PAGE 23  

1330   1         if(fAlarm==1)
1331   1         {
1332   2            count1++;
1333   2            if(count1==10)
1334   2            {
1335   3               count1=0;
1336   3               buzzer=!buzzer;
1337   3            }
1338   2         }
1339   1         if(STPRun==1)
1340   1         {
1341   2            if(STPtime<100)//if(STPtime<1000)
1342   2            {
1343   3               STPtime++;
1344   3            }
1345   2            else
1346   2            {
1347   3               STPtime=0;
1348   3               if(STPSec<59) STPSec++;
1349   3               else 
1350   3               {
1351   4                  STPSec=0;
1352   4                  if(STPMin<59) STPMin++;
1353   4                  else STPMin=0;
1354   4               }
1355   3            }
1356   2         }
1357   1         
1358   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3452    ----
   CONSTANT SIZE    =    686    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     31    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      9    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
